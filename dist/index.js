$(document).ready(function(){function e(){$.post("/ajax/getPeriodSales",{startTime:$(".startTime").datepicker("getDate","yyyy-mm-dd"),endTime:$(".endTime").datepicker("getDate","yyyy-mm-dd")},function(e){a.myChart2&&a.myChart2.clear(),a.myChart2=echarts.init(document.getElementById("periodSales"));var t={title:{text:"总销售额/天(元)"},tooltip:{trigger:"axis"},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:e.data.dates},yAxis:{type:"value"},series:[{name:"",type:"line",stack:"总量",data:e.data.sales}]};a.myChart2.setOption(t)})}function t(){var e=$(".oneday").datepicker("getDate","yyyy-mm-dd");$.post("/ajax/getOnedayTable",{date:e},function(t){a.onedayTable&&a.onedayTable.destroy();var n=["<tr>",'<td><a target="_blank" href="/detail?date='+e+'&id=${productId}&name=${encodeURIComponent(productName)}">${productName}</a></td>',"<td>${(sellAmount/10000).toFixed(0)}</td>","<td>${(financeTotalAmount/10000).toFixed(0)}</td>","<td>${yearReturnRate}</td>","<td>${investementDays}</td>","<td>${interestStartTime}</td>","<td>${interestEndTime}</td>","</tr>"].join("");$.template("onedayTemplate",n),$("#onedayTbody").html($.tmpl("onedayTemplate",t.data.prod)),a.onedayTable=$("#onedayTable").DataTable({order:[[0,"desc"]]})}),$.post("/ajax/getOnedayChart",{date:e},function(e){a.myChart3&&a.myChart3.clear(),a.myChart3=echarts.init(document.getElementById("onedayChart"));var t={title:{text:"销售额/小时(元)"},color:["#3398DB"],tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:[{type:"category",data:["1点","2点","3点","4点","5点","6点","7点","8点","9点","10点","11点","12点","13点","14点","15点","16点","17点","18点","19点","20点","21点","22点","23点","24点"],axisTick:{alignWithLabel:!0}}],yAxis:[{type:"value"}],series:[{name:"前一小时销售额",type:"bar",barWidth:"75%",data:e.data.serials}]};a.myChart3.setOption(t)})}var a={},n={autoHide:!0,language:"zh-CN",format:"yyyy-mm-dd",yearFirst:!0,autoPick:!0,startDate:"2017-12-21",endDate:new Date(+new Date-864e5)};$.fn.datepicker.setDefaults(n),$(".datepicker").on("keydown",function(e){e.preventDefault()}),$(".startTime").datepicker({date:new Date(+new Date-864e6)}),$(".endTime").datepicker({date:new Date(+new Date-864e5)}),$(".startTime").on("pick.datepicker",function(e){$(".endTime").datepicker("destroy"),$(".endTime").datepicker({startDate:e.date}),$(".endTime").datepicker("show")}),$(".endTime").on("hide.datepicker",function(t){e()}),$.post("/ajax/getInitSales",function(e){a.myChart1=echarts.init(document.getElementById("nowSales"));var t={title:{text:"实时数据",subtext:"10秒刷新"},tooltip:{trigger:"axis",axisPointer:{type:"cross",label:{backgroundColor:"#283b56"}}},legend:{data:["最新售卖记录","已售总金额"]},dataZoom:{show:!1,start:0,end:100},xAxis:[{type:"category",boundaryGap:!0,data:function(){for(var e=new Date,t=[],a=10;a--;)t.unshift(e.toLocaleTimeString().replace(/^\D*/,"")),e=new Date(e-1e4);return t}()}],yAxis:[{type:"value",scale:!0,name:"已售总金额",max:5e7,min:0,boundaryGap:[.2,.2]},{type:"value",scale:!0,name:"前10秒售卖金额",max:1e6,min:0,boundaryGap:[.2,.2]}],series:[{name:"前10秒售卖金额",type:"bar",xAxisIndex:0,yAxisIndex:1,data:e.data.span},{name:"已售总金额",type:"line",xAxisIndex:0,yAxisIndex:0,data:e.data.total}]};a.myChart1.setOption(t),setInterval(function(){$.post("/ajax/getNowSales",function(e){var n=(new Date).toLocaleTimeString().replace(/^\D*/,""),d=t.series[0].data,i=t.series[1].data;d.shift(),d.push(e.data.total-i[9]),i.shift(),i.push(e.data.total),t.xAxis[0].data.shift(),t.xAxis[0].data.push(n),a.myChart1.setOption(t)})},1e4)}),e(),$(".oneday").datepicker({date:new Date(+new Date-864e5)}),t(),$(".oneday").on("pick.datepicker",function(e){t()})});